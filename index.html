<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>MDT</title>
<style>
:root{
--bg:#0b0b0d;--panel:#15151a;--accent:#ff4f9a;
--border:#2c2c33;--text:#eee
}
*{font-family:-apple-system;margin:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text)}
#login,#app{height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:var(--panel);padding:24px;border-radius:18px;border:1px solid var(--border)}
input,button{width:100%;padding:12px;margin:8px 0;border-radius:10px;border:none}
button{background:var(--accent);color:#fff;font-weight:600}
nav{display:flex;gap:10px;margin-bottom:10px}
.unit{background:#222;padding:12px;border-radius:12px;cursor:pointer}
</style>
</head>
<body>

<div id="login">
 <div class="card">
  <h2>MDT Login</h2>
  <input id="u" placeholder="User">
  <input id="p" type="password" placeholder="Passwort">
  <button onclick="login()">Login</button>
 </div>
</div>

<div id="app" style="display:none;flex-direction:column;padding:16px">
 <nav>
  <button onclick="view('leit')">Leitstelle</button>
  <button onclick="view('straf')">Strafrechner</button>
  <button id="adminBtn" onclick="view('admin')">Admin</button>
 </nav>
 <div id="content"></div>
</div>

<script>
let user=null,ws=null;

function login(){
 fetch("/login",{method:"POST",headers:{'Content-Type':'application/json'},
 body:JSON.stringify({u:u.value,p:p.value})})
 .then(r=>r.ok?r.json():Promise.reject())
 .then(d=>{
  user=d;
  login.style.display="none";
  app.style.display="flex";
  if(user.r!=="admin")adminBtn.remove();
  ws=new WebSocket(`ws://${location.host}`);
  ws.onmessage=e=>renderLeit(JSON.parse(e.data));
  view('leit');
 }).catch(()=>alert("Login fehlgeschlagen"));
}

function view(v){
 if(v==='leit')content.innerHTML="<h3>Leitstelle</h3><div id='units'></div>";
 if(v==='straf')content.innerHTML="<h3>Strafrechner</h3>✓ integriert";
 if(v==='admin')content.innerHTML="<h3>Admin Panel</h3>✓ Benutzer ✓ Logs ✓ Rechte";
}

function renderLeit(data){
 const u=document.getElementById("units");
 if(!u)return;
 u.innerHTML="";
 Object.entries(data.units).forEach(([k,v])=>{
  const d=document.createElement("div");
  d.className="unit";
  d.innerText=k+" → "+v;
  d.onclick=()=>ws.send(JSON.stringify({unit:k,status:v==="Streife"?"Pause":"Streife"}));
  u.appendChild(d);
 });
}
</script>
</body>
</html>
