<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>LSPD MDT</title>
<style>
:root{
 --bg:#0b0b0c;
 --card:#1c1c1e;
 --accent:#ff4f9a;
 --muted:#9a9a9a;
}
body{
 margin:0;
 background:linear-gradient(180deg,#0b0b0c,#151517);
 font-family:-apple-system,BlinkMacSystemFont;
 color:#eee;
}
header{
 display:flex;
 gap:10px;
 padding:12px;
 background:rgba(20,20,22,.85);
 backdrop-filter: blur(25px);
}
button{
 background:linear-gradient(180deg,#ff4f9a,#ff2f85);
 border:none;
 color:white;
 padding:8px 14px;
 border-radius:12px;
 font-weight:600;
 cursor:pointer;
}
.card{
 background:rgba(28,28,30,0.9);
 border-radius:16px;
 padding:14px;
 margin:10px;
 box-shadow:0 10px 30px rgba(0,0,0,.6);
 backdrop-filter: blur(20px);
}
.hidden{display:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
<h2>üîê Login</h2>
<input id="lu" placeholder="User"><br><br>
<input id="lp" type="password" placeholder="Pass"><br><br>
<button onclick="login()">Login</button>
</div>

<!-- MDT -->
<div id="app" class="hidden">
<header>
<button onclick="tab('rechner')">Strafrechner</button>
<button onclick="tab('persons')">Personen</button>
<button onclick="tab('vehicles')">Fahrzeuge</button>
<button onclick="tab('weapons')">Waffen</button>
<button onclick="tab('calls')">Eins√§tze</button>
</header>

<div id="content"></div>
</div>

<script>
let ROLE=null;
let STATE={};
let WS=null;

function login(){
fetch("http://localhost:3000/login",{
 method:"POST",
 headers:{'Content-Type':'application/json'},
 body:JSON.stringify({user:lu.value,pass:lp.value})
}).then(r=>{
 if(!r.ok) throw 0;
 return r.json();
}).then(d=>{
 ROLE=d.role;
 loginDiv(false);
 connectWS();
}).catch(()=>alert("Login fehlgeschlagen"));
}

function loginDiv(ok){
login.classList.toggle("hidden",ok);
app.classList.toggle("hidden",!ok);
}

function connectWS(){
WS=new WebSocket("ws://localhost:3000");
WS.onmessage=e=>{
 const m=JSON.parse(e.data);
 STATE=m.data;
 render();
};
}

function sync(){
WS.send(JSON.stringify({type:"SYNC",data:STATE}));
}

function tab(t){
if(t==="rechner"){
content.innerHTML=`
<div class="card">
<h3>Strafrechner</h3>
${STATE.laws.map((l,i)=>`
${l.p} ‚Äì ${l.d} (${l.w}W / $${l.f})
<button onclick="addLaw(${i})">+</button><br>
`).join("")}
<div id="entry"></div>
</div>`;
}
if(t==="persons"){
content.innerHTML=`
<div class="card">
<h3>Personen</h3>
<input id="pn"><button onclick="addPerson()">+</button>
${STATE.persons.map(p=>`${p.name} (${p.wanteds})`).join("<br>")}
</div>`;
}
if(t==="vehicles"){
content.innerHTML=`
<div class="card">
<h3>Fahrzeuge</h3>
${STATE.vehicles.map(v=>`${v.plate} ${v.model}`).join("<br>")}
</div>`;
}
if(t==="weapons"){
content.innerHTML=`
<div class="card">
<h3>Waffen</h3>
${STATE.weapons.map(w=>`${w.serial} ${w.type}`).join("<br>")}
</div>`;
}
if(t==="calls"){
content.innerHTML=`
<div class="card">
<h3>Eins√§tze</h3>
<input id="ct"><button onclick="addCall()">+</button>
${STATE.calls.map(c=>c.text).join("<br>")}
</div>`;
}
}

function addLaw(i){
entry.innerText+=STATE.laws[i].p+" ";
}
function addPerson(){
STATE.persons.push({name:pn.value,wanteds:0});
sync();
}
function addCall(){
STATE.calls.push({text:ct.value});
sync();
}

function render(){ tab("rechner"); }
</script>
</body>
</html>
