<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>LSPD MDT</title>

<style>
:root{
 --bg:#0b0b0c;
 --card:#1c1c1e;
 --accent:#ff4f9a;
 --muted:#9a9a9a;
}
*{box-sizing:border-box}
body{
 margin:0;
 background:linear-gradient(180deg,#0b0b0c,#151517);
 font-family:-apple-system,BlinkMacSystemFont;
 color:#eee;
}
header{
 display:flex;
 gap:8px;
 padding:12px;
 background:rgba(20,20,22,.85);
 backdrop-filter: blur(25px);
 border-bottom:1px solid #2a2a2c;
}
button{
 background:linear-gradient(180deg,#ff4f9a,#ff2f85);
 border:none;
 color:white;
 padding:8px 14px;
 border-radius:12px;
 font-weight:600;
 cursor:pointer;
}
button.gray{
 background:#2c2c2e;
}
.card{
 background:rgba(28,28,30,.95);
 border-radius:16px;
 padding:14px;
 margin:12px;
 box-shadow:0 10px 30px rgba(0,0,0,.6);
 backdrop-filter: blur(20px);
}
input,textarea{
 width:100%;
 padding:8px;
 margin-top:6px;
 background:#0f0f10;
 border:1px solid #333;
 color:white;
 border-radius:10px;
}
.hidden{display:none}
.small{font-size:12px;color:var(--muted)}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
<h2>üîê MDT Login</h2>
<input id="lu" placeholder="Benutzer">
<input id="lp" type="password" placeholder="Passwort">
<br><br>
<button onclick="login()">Login</button>
<p class="small">Admin-Reset: Benutzer = ADMIN / Passwort = 9999</p>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header>
<button onclick="tab('dashboard')">Leitstelle</button>
<button onclick="tab('rechner')">Strafrechner</button>
<button onclick="tab('persons')">Personen</button>
<button onclick="tab('vehicles')">Fahrzeuge</button>
<button onclick="tab('weapons')">Waffen</button>
<button onclick="tab('calls')">Eins√§tze</button>
<button id="adminBtn" class="hidden" onclick="tab('admin')">Admin</button>
<button class="gray" onclick="logout()">Logout</button>
</header>

<div id="content"></div>
</div>

<script>
/* ================== LIVE SYNC ================== */
const bc = new BroadcastChannel("mdt-sync");
bc.onmessage = e => {
 STATE = e.data;
 render();
};
function sync(){
 bc.postMessage(STATE);
 save();
}

/* ================== STORAGE ================== */
function save(){ localStorage.STATE = JSON.stringify(STATE); }
function load(){ return JSON.parse(localStorage.STATE || "null"); }

/* ================== USERS ================== */
const USERS_DEFAULT = [
 {u:"ADMIN",p:"9999",r:"admin"},
 {u:"LSPD",p:"1234",r:"officer"},
 {u:"CADET",p:"1111",r:"cadet"}
];
if(!localStorage.USERS) localStorage.USERS = JSON.stringify(USERS_DEFAULT);

/* ================== STATE ================== */
let STATE = load() || {
 persons:[],
 vehicles:[],
 weapons:[],
 calls:[],
 laws:[
  {p:"BtMG ¬ß2.1",d:"Drogenbesitz Klein",w:1,f:15000},
  {p:"BtMG ¬ß2.2",d:"Drogenhandel",w:3,f:30000}
 ],
 audit:[]
};

let CURRENT = null;

/* ================== LOGIN ================== */
function login(){
 const users = JSON.parse(localStorage.USERS);
 const u = users.find(x=>x.u===lu.value && x.p===lp.value);
 if(!u) return alert("Login fehlgeschlagen");
 CURRENT = u;
 loginDiv(true);
 document.getElementById("adminBtn").classList.toggle("hidden", u.r!=="admin");
 log(`Login: ${u.u}`);
 render();
}
function logout(){
 CURRENT=null;
 loginDiv(false);
}
function loginDiv(ok){
 login.classList.toggle("hidden",ok);
 app.classList.toggle("hidden",!ok);
}

/* ================== AUDIT ================== */
function log(t){
 STATE.audit.unshift(`[${new Date().toLocaleTimeString()}] ${CURRENT.u}: ${t}`);
 STATE.audit = STATE.audit.slice(0,50);
 sync();
}

/* ================== TABS ================== */
function tab(t){
 if(t==="dashboard"){
  content.innerHTML=`<div class="card"><h3>üö® Leitstelle</h3>
  Aktive Eins√§tze: ${STATE.calls.length}<br>
  Personenakten: ${STATE.persons.length}</div>`;
 }
 if(t==="rechner"){
  content.innerHTML=`<div class="card"><h3>‚öñÔ∏è Strafrechner</h3>
  ${STATE.laws.map(l=>`${l.p} ‚Äì ${l.d} (${l.w}W / $${l.f})<br>`).join("")}
  </div>`;
 }
 if(t==="persons"){
  content.innerHTML=`<div class="card"><h3>üë§ Personen</h3>
  <input id="pn" placeholder="Name">
  <button onclick="addPerson()">Hinzuf√ºgen</button><br><br>
  ${STATE.persons.map(p=>`${p.name} (${p.wanteds}W)`).join("<br>")}
  </div>`;
 }
 if(t==="vehicles"){
  content.innerHTML=`<div class="card"><h3>üöó Fahrzeuge</h3>
  ${STATE.vehicles.map(v=>`${v.plate} ${v.model}`).join("<br>")}
  </div>`;
 }
 if(t==="weapons"){
  content.innerHTML=`<div class="card"><h3>üî´ Waffen</h3>
  ${STATE.weapons.map(w=>`${w.serial} ${w.type}`).join("<br>")}
  </div>`;
 }
 if(t==="calls"){
  content.innerHTML=`<div class="card"><h3>üìª Eins√§tze</h3>
  <input id="ct" placeholder="Einsatz">
  <button onclick="addCall()">Hinzuf√ºgen</button><br><br>
  ${STATE.calls.map(c=>c.text).join("<br>")}
  </div>`;
 }
 if(t==="admin" && CURRENT.r==="admin"){
  content.innerHTML=`<div class="card"><h3>üõ† Admin</h3>
  <b>Audit-Log</b><br>
  ${STATE.audit.join("<br>")}
  </div>`;
 }
}

/* ================== ACTIONS ================== */
function addPerson(){
 STATE.persons.push({name:pn.value,wanteds:0});
 log("Person erstellt");
}
function addCall(){
 STATE.calls.push({text:ct.value});
 log("Einsatz erstellt");
}

/* ================== INIT ================== */
render();
function render(){ if(CURRENT) tab("dashboard"); }
</script>

</body>
</html>
